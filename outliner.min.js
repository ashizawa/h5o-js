/**
 * This code contains an implementation of HTML5 outlining algorithm, as described by WHATWG at [1]
 *
 * The copyright notice at [2] says:
 *		(c) Copyright 2004-2009 Apple Computer, Inc., Mozilla Foundation, and Opera Software ASA.
 *		You are granted a license to use, reproduce and create derivative works of this document.
 *
 * [1] http://www.whatwg.org/specs/web-apps/current-work/multipage/sections.html#outlines
 * [2] http://www.whatwg.org/specs/web-apps/current-work/multipage/index.html
 */
!function(){var a=function(a){this.sections=[],this.startingNode=a};a.prototype={heading:!1,append:function(a){a.container=this,this.sections.push(a)},asHTML:function(a){var b=i(this.heading);return a&&(b='<a href="#'+j(this.startingNode)+'">'+b+"</a>"),b+g(this.sections,a)}};var b,c,d,e,f,g=function(a,b){for(var c="",d=0;d<a.length;d++)c+="<li>"+a[d].asHTML(b)+"</li>";return""==c?c:"<ol>"+c+"</ol>"},h=function(a){var b=a.heading;return r(b)?t(b):1},i=function(a){return r(a)?("HGROUP"==n(a)&&(a=a.getElementsByTagName("h"+-t(a))[0]),a.textContent||a.innerText||"<i>No text content inside "+a.nodeName+"</i>"):""+a},j=function(a){var b=a.getAttribute("id");if(b)return b;do b="h5o-"+ ++e;while(f.getElementById(b));return a.setAttribute("id",b),b},k=function(a,b,c){var d=a;a:for(;d;)if(b(d),d.firstChild)d=d.firstChild;else for(;d;){if(c(d),d.nextSibling){d=d.nextSibling;continue a}d=d==a?null:d.parentNode}},l=function(e){if(!r(v(d))){if(q(e)||p(e))return null!=b&&d.push(b),b=e,c=new a(e),void(b.outline={sections:[c],startingNode:e,asHTML:function(a){return g(this.sections,a)}});if(null!=b&&r(e)){if(c.heading)if(t(e)>=h(u(b.outline))){var f=new a(e);b.outline.sections.push(f),c=f,c.heading=e}else{var i=!1,j=c;do{if(t(e)<h(j)){var f=new a(e);j.append(f),c=f,c.heading=e,i=!0}var k=j.container;j=k}while(!i)}else c.heading=e;return void d.push(e)}}},m=function(a){var e=v(d);if(r(e))return void(e==a&&d.pop());if(!q(a)&&!p(a)||c.heading||(c.heading="<i>Untitled "+n(a)+"</i>"),q(a)&&d.length>0){b=d.pop(),c=u(b.outline);for(var f=0;f<a.outline.sections.length;f++)c.append(a.outline.sections[f])}else{if(!(p(a)&&d.length>0))return q(a)||p(a)?void(c=b.outline.sections[0]):void 0;for(b=d.pop(),c=u(b.outline);c.sections.length>0;)c=u(c)}},n=function(a){return a.tagName.toUpperCase()},o=function(a){return function(b){return s(b)&&new RegExp(a,"i").test(n(b))}},p=o("^BLOCKQUOTE|BODY|DETAILS|FIELDSET|FIGURE|TD$"),q=o("^ARTICLE|ASIDE|NAV|SECTION$"),r=o("^H[1-6]|HGROUP$"),s=function(a){return a&&a.tagName},t=function(a){var b=n(a);if("HGROUP"!=b)return-parseInt(b.substr(1));for(var c=1;6>=c;c++)if(a.getElementsByTagName("H"+c).length>0)return-c},u=function(a){return v(a.sections)},v=function(a){return a[a.length-1]};HTML5Outline=function(a){return e=0,f=a.ownerDocument||window.document,b=null,c=null,d=[],k(a,l,m),null!=b?b.outline:null}}();